!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){(function(){var b,c,d,e,f=[].slice;c=a("../granula/granula"),d=a("../granula/keys"),angular.module("granula",[]),b=a("../runner/defaultOptions"),angular.module("granula").provider("grService",function(){var a,e,g,h,i,j,k,l,m;return h=c(),e={},j=b,m=function(a){var b;return b=a.search(/\|\s*grPluralize/i),-1!==b?a.substring(0,b):a},i=function(a){return e[a]||(e[a]=[null]),function(b){return b.match(/[0-9]+/)?e[a][b]:(-1===e[a].indexOf(b)&&e[a].push(b),b)}},a=function(a){return null==a&&(a=function(a){return a}),{begin:function(){},string:function(a,b){return b},argument:function(b,c){var d;return d=c.argName,"{{"+a(d)+"}}"},pluralExpression:function(b,c,d){var e,f,g;return g=c.word,f=c.suffixes,e=d.argName,"{{"+m(a(e))+" | grPluralize:'"+g+"("+f.join(",")+")'}}"},end:function(){}}},l=function(){return{string:function(){return""},argument:function(){return""},pluralExpression:function(a,b){var c;return c=b.fn,c(a.attrs[1])}}},k={},g={},{config:function(a){return angular.extend(j,b,a)},$get:["$rootScope",function(b){var c;return c=function(a,b){var c;return c={},c[a]=null!=b?b:{},c},{language:"en",originalLanguage:"en",toKey:function(a,b){return d.toKey(a,b,j)},isOriginal:function(){return this.language===this.originalLanguage},_registerOriginal:function(){return this.register(this.originalLanguage),this._registerOriginal=function(){}},setOriginalLanguage:function(a){return this.originalLanguage=a,this._registerOriginal()},setLanguage:function(a){var c,d,e,f=this;if((a!==this.language||g[a])&&(null!=(e=g[a])?!e.loading:!0))return this._loading=a,c=function(c){return b.$broadcast("gr-lang-load",a),g[a].loading=g[a].length,g[a].forEach(function(d){return d(function(d,e){return d?(console.error(d),b.$broadcast("gr-lang-load-error",d)):(f.register(a,e),g[a].loading--,0===g[a].loading?(delete g[a],c()):void 0)})})},d=function(){return a===f._loading?(f.language=a,b.$broadcast("gr-lang-changed",a)):void 0},g[a]?c(function(){return d()}):d()},register:function(a,b){if(!a)throw new Error("language shall be defined!");return angular.isFunction(b)?(null==g[a]&&(g[a]=[]),g[a].push(b)):h.load(c(a,b))},save:function(a,b,d){var e;return null==d&&(d=this.originalLanguage),e=c(d),e[d][a]=b,h.load(e)},canTranslate:function(a,b){return null==b&&(b=this.language),h.canTranslate(b,a)},canTranslateTo:function(a){return null==a&&(a=this.language),h.canTranslateTo(a)||g[a]},translate:function(){var a,b,c,d;return c=arguments[0],b=arguments[1],a=3<=arguments.length?f.call(arguments,2):[],null==b&&(b={}),angular.isObject(c)&&(b=c,c=null),angular.isObject(b)?angular.extend(b,{language:this.language}):(a.unshift(b),b={language:this.language}),g[b.language]?"":(d=this.toKey(b.key,c),this.isOriginal()&&c&&this.save(d,c,b.language),h.translate(b.language,d,a))},compile:function(b,c,d){var f;null==c&&(c=this.language),null==d&&(d=!0),this._registerOriginal(),void 0===e[b]&&c!==this.originalLanguage&&this.compile(b,this.originalLanguage,!1);try{return h.compile(c,{key:b}).apply(a(i(b)))}catch(j){if(f=j,!g[c]){if(!d)throw f;console.error(f.message,f)}return""}},plural:function(a,b){var c,d,e=this;return c=null!=(d=k[a])?d:function(){return k[a]=h.compile(e.language,""+a+":1")}(),c.apply(l(),b)}}}]}}),angular.module("granula").filter("grPluralize",["grService",function(a){return function(b,c){return a.plural(c,b)}}]),angular.module("granula").directive("grStatus",function(){return function(a,b){return a.$on("gr-lang-load",function(){return b.addClass("gr-lang-load")}),a.$on("gr-lang-load-error",function(){return b.removeClass("gr-lang-load")}),a.$on("gr-lang-changed",function(){return b.removeClass("gr-lang-load")})}}),angular.module("granula").directive("grLang",["$rootScope","grService","$interpolate","$http",function(a,b,c,d){var e,f;return f=function(a,c){var e,f;if(f=c.grLang,0===(null!=f?f:"").length)throw new Error("gr-lang for script element shall have value - name of language");if(c.src)b.register(f,function(a){return d({method:"GET",url:c.src}).success(function(b){return a(null,b)}).error(function(){return a("Cannot load "+c.src+" for language "+f)})});else try{b.register(f,JSON.parse(a.text()))}catch(g){throw e=g,new Error("Cannot parse json for language '"+f+"'",e)}return void 0},e=function(a,d){var e;return d.grLangOfText&&b.setOriginalLanguage(d.grLangOfText),e=c(d.grLang,!0),e||!b.canTranslateTo(d.grLang)?b.setLanguage(b.originalLanguage):b.setLanguage(d.grLang),function(a,c,d){return d.$observe("grLang",function(a){return a.length?b.setLanguage(a):void 0})}},{compile:function(a,b){return"SCRIPT"===a[0].tagName?f(a,b):e(a,b)}}}]),e=function(a,b,c,d,e,f,g){var h,i,j;return j=e(g),d&&(a.save(d,j),h=a.compile(d),i=b(h,!0)),(i||c)&&f(g,""),{link:function(e,g){var h,j,k,l,m;return m=i,h=d,k=function(){return m=b(a.compile(h)),f(g,m(e))},l=function(b){if(a.language===a.originalLanguage)return f(g,b);if(!m)throw new Error("outputFn is undefined but it shall not be");return f(g,m(e))},j=function(a){return h!==a?(h=a,k()):void 0},e.$on("gr-lang-changed",function(){return k()}),i&&e.$watch(i,function(a){return l(a)}),c&&e.$watch(c,function(a){return j(a)}),d&&k(),{onKeyChanged:j}}}},angular.module("granula").directive("grAttrs",["grService","$interpolate",function(a,b){var c,d;return c=function(a){return function(b){return b.attr(a)}},d=function(a){return function(b,c){return b.attr(a,c)}},{compile:function(f,g){var h,i;return h=g.grAttrs.split(","),i=h.map(function(h){var i,j,k,l;return i="grKey"+(h[0].toUpperCase()+h.substring(1)),k=a.toKey(g[i],f.attr(h)),g[i]&&(j=b(k,!0)),l=j?null:k,{link:e(a,b,j,l,c(h),d(h),f).link,attrName:h}}),function(a,b){var c;return c=i.map(function(c){return c.link(a,b).onKeyChanged})}}}}]),angular.module("granula").directive("grKey",["grService","$interpolate",function(a,b){var c,d;return c=function(a){return a.html()},d=function(a,b){return a.html(b)},{compile:function(f,g){var h,i,j,k;return i=a.toKey(g.grKey,f.text()),g.grKey&&(h=b(i,!0)),k=h?null:i,j=e(a,b,h,k,c,d,f).link,function(a,b){return j(a,b)}}}}])}).call(this)},{"../granula/granula":4,"../granula/keys":6,"../runner/defaultOptions":8}],2:[function(a,b){(function(){var a,c=[].slice;a=function(a,b){var d,e,f,g,h,i,j,k,l;if(e={attrs:{}},1===a.length&&"object"==typeof a[0]){l=a[0];for(g in l)i=l[g],e.attrs[g]=i}else for(f=j=0,k=a.length;k>j;f=++j)d=a[f],e.attrs[f+1]=d;return h=function(){},e.interpolate=function(){var a,d,f;return d=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],(null!=(f=b[d])?f:h).apply(null,[e].concat(c.call(a)))},e.begin=function(){return"function"==typeof b.begin?b.begin(e):void 0},e.end=function(a){return"function"==typeof b.end?b.end(e,a):void 0},e.apply=function(a){var b,c;return e.begin(),b=a(e),null!=(c=e.end(b))?c:b},e},b.exports={context:a}}).call(this)},{}],3:[function(a,b){(function(){var a,c,d,e,f,g;d=function(a){return{apply:function(b){var c;return null!=(c=b.interpolate("string",a))?c:a}}},a=function(a){return{argName:a,apply:function(b){return b.interpolate("argument",{argName:a})}}},c=function(b,c){return null==b&&(b="{{"),null==c&&(c="}}"),{nextPosition:function(a,c){return a.indexOf(b,c)},process:function(d,e){var f,g;if(g=d.indexOf(c,e),-1===g)throw new Error("Syntax error: uncompleted argument definition started at char "+e+": "+d+" ");return f=d.substring(e+b.length,g),{part:a(f),currentPos:g+c.length}}}},e=function(){return{nextPosition:function(){return-1}}},f=function(a,b){return""+a+"("+b.join(",")+")"},g=function(b){var c,g,h,i,j,k,l,m,n;return b?(l="(",c=")",g="\\",k=",",n=/[\s,.!:;'\"-+=*%$#@{}()]/,m=/[\s,!:'\"+=*%$#@{}()-]/,h=":",i=[">","&gt;"],j=function(c,d,e){var g;return g=b(c,d),{argument:"string"==typeof e?a(e):null,apply:function(a){return a.interpolate("pluralExpression",{word:c,suffixes:d,fn:g},this.argument)},link:function(a,b){var g,h,i,j,k,l,m;if(null===this.argument){if(e.prev===!0)i=function(){l=[];for(var a=b;0>=b?0>=a:a>=0;0>=b?a++:a--)l.push(a);return l}.apply(this),g="left";else{if(e.next!==!0)throw new Error("invalid link "+e+" - expected {prev:true} or {next:true}");i=function(){m=[];for(var c=b,d=a.parts.length-1;d>=b?d>=c:c>=d;d>=b?c++:c--)m.push(c);return m}.apply(this),g="right"}for(j=0,k=i.length;k>j;j++)if(h=i[j],a.parts[h].argName){this.argument=a.parts[h];break}if(null===this.argument)throw new Error("There is no argument nearest to the "+g+" for plural expression '"+f(c,d)+")'")}}}},{nextPosition:function(a,b){var c,d;for(c=a.indexOf(l,b);c>=b&&!(null!=(d=a[c-1])?d:" ").match(n);)c--;return c},process:function(a,b){var e,f,n,o,p,q,r;if(n=a.indexOf(c,b),q=a.substring(b,n),p=q.split(l),p[0].length>0&&p[0].slice(-1)===g)return{part:d(""+p[0].slice(0,-1)+l+p[1]+c),currentPos:n+c.length};if(e={prev:!0},f=n+c.length,a[n+c.length]===h){for(r=n+c.length+1,n=r;n<a.length&&!a[n].match(m);)n++;o=a.substring(r,n),i.indexOf(o)>-1?(e={next:!0},f=n):o.length>0&&(e=o,f=n)}return{part:j(p[0],p[1].split(k),e),currentPos:f}}}):e()},b.exports={argumentParser:c,pluralizerParser:g,justText:d}}).call(this)},{}],4:[function(a,b){(function(){var c,d,e,f,g,h,i,j,k,l=[].slice;k=a("./compile/parsers"),c=k.argumentParser,h=k.pluralizerParser,e=k.justText,j=a("./interpolators").stringInterpolator,d=a("./compile/context").context,g=a("./pluralization")(),b.exports=function(){var a,b;return a={},b={},{defaultInterpolator:j(),load:function(b){var c,d,e,f,h;h=[];for(d in b)e=b[d],a[d]||(a[d]={}),h.push(function(){var b;b=[];for(c in e)f=e[c],"_pluralize"===c?b.push(g.updatePluralization(d,e._pluralize,e._normalize)):"_normalize"===c||b.push(a[d][c]=f);return b}());return h},translate:function(){var a,b,c;return c=arguments[0],b=arguments[1],a=3<=arguments.length?l.call(arguments,2):[],this._apply.apply(this,[c,b].concat(l.call(a)))},canTranslate:function(b,c){var d;return void 0!==(null!=(d=a[b])?d[c]:void 0)},canTranslateTo:function(b){return void 0!==a[b]},compile:function(a,b){var c;return c=b.key?this._precompiled(a,b.key):i(b,this._parsers(a)),this._applier(c)},debug:function(a,b){return null==b&&(b="en"),this.compile(b,a).apply({begin:function(){return console.log("{")},argument:function(a,b){var c;return c=b.argName,console.log("  arg: "+c)},pluralExpression:function(a,b,c){var d,e,f;return f=b.word,e=b.suffixes,d=c.argName,console.log("  plural: "+f+"("+e+"):"+d)},string:function(a,b){return console.log("  '"+b+"'")},end:function(){return console.log("}")}})},_applier:function(a){var b,c=this;return b=function(){var b;return b=1<=arguments.length?l.call(arguments,0):[],a.apply(b,c.defaultInterpolator)},b.apply=function(){var b,c;return c=arguments[0],b=2<=arguments.length?l.call(arguments,1):[],a.apply(b,c)},b},_precompiled:function(a,c){var d,e;return null!=(d=null!=(e=b[a])?e[c]:void 0)?d:this._precompile(a,c)},_parsers:function(a){return[c(),h(function(b,c){return g.preparePluralizationFn(a,b,c)})]},_precompile:function(a,c){return b[a]||(b[a]={}),b[a]._parsers||(b[a]._parsers=this._parsers(a)),b[a][c]=i(this._get(a,c),b[a]._parsers)},_apply:function(){var a,b,c;return c=arguments[0],b=arguments[1],a=3<=arguments.length?l.call(arguments,2):[],this._precompiled(c,b).apply(a,this.defaultInterpolator)},_get:function(b,c){var d;if(!a[b])throw new Error("Language '"+b+"' was not initialized with 'load' method");if(d=a[b][c],!d)throw new Error("There is no definition for '"+c+"' in language '"+b+"'");return d}}},f=function(a){return a.length>0},i=function(a,b){var c,g,h,i,j,k,l,m,n,o,p;for(c={parts:[]},g=0,m=b.map(function(b){return b.nextPosition(a,0)}),h=function(){return m.every(function(a){return-1===a})};!h();)i=Math.min.apply(null,m.filter(function(a){return a>-1})),k=m.indexOf(i),j=b[k],o=a.substring(g,i),f(o)&&c.parts.push(e(o)),p=j.process(a,i,c),l=p.part,g=p.currentPos,c.parts.push(l),m.forEach(function(c,d){return g>c?m[d]=b[d].nextPosition(a,g):void 0});return n=a.substring(g),f(n)&&c.parts.push(e(n)),c.parts.forEach(function(a,b){return a.link?a.link(c,b):void 0}),{apply:function(a,b){return d(a,b).apply(function(a){return c.parts.map(function(b){return b.apply(a)}).join("")})}}}}).call(this)},{"./compile/context":2,"./compile/parsers":3,"./interpolators":5,"./pluralization":7}],5:[function(a,b){(function(){var a;a=function(){return{begin:function(){},string:function(a,b){return b},argument:function(a,b){var c,d;return c=b.argName,d=a.attrs[c],"function"==typeof d?d():d},pluralExpression:function(a,b,c){var d;return d=b.fn,d(c.apply(a))},end:function(){}}},b.exports={stringInterpolator:a}}).call(this)},{}],6:[function(a,b){(function(){var a;a=function(a,b){return null==b&&(b=function(){}),void 0===a||0===a.trim().length?(b(),void 0):a},b.exports={textToKey:function(a,b){return null==b&&(b={wordsLimitForKey:10,replaceSpaces:!1}),a?a.split(/\s+/).slice(0,b.wordsLimitForKey).join(b.replaceSpaces?b.replaceSpaces:" "):void 0},toKey:function(b,c,d){var e;switch(null==d&&(d={textAsKey:"nokey"}),d.textAsKey){case!0:case"always":return this.textToKey(c,d);case!1:case"never":return a(b,function(){throw new Error("Mandatory key attribute is not defined")});case"nokey":return null!=(e=a(b))?e:this.textToKey(c,d);default:throw new Error("Unknown option '"+d.textAsKey+"', possible values: 'never', 'always', 'nokey'")}}}}).call(this)},{}],7:[function(a,b){(function(){var a,c;c=[{plural:function(a){return a>1?1:0},languages:["ach","ak","am","arn","br","fil","fr","gun","ln","mfe","mg","mi","oc","pt_BR","tg","ti","tr","uz","wa","zh"]},{plural:function(a){return 1!=a?1:0},languages:["af","an","ast","az","bg","bn","brx","ca","da","de","doi","el","en","eo","es","es_AR","et","eu","ff","fi","fo","fur","fy","gl","gu","ha","he","hi","hne","hy","hu","ia","it","kn","ku","lb","mai","ml","mn","mni","mr","nah","nap","nb","ne","nl","se","nn","no","nso","or","ps","pa","pap","pms","pt","rm","rw","sat","sco","sd","si","so","son","sq","sw","sv","ta","te","tk","ur","yo"]},{plural:function(a){return 0==a?0:1==a?1:2==a?2:a%100>=3&&10>=a%100?3:a%100>=11?4:5},languages:["ar"]},{plural:function(){return 0},languages:["ay","bo","cgg","dz","fa","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","my","sah","su","th","tt","ug","vi","wo","zh"]},{plural:function(a){return a%10==1&&a%100!=11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2},languages:["be","bs","hr","ru","sr","uk"]},{plural:function(a){return 1==a?0:a>=2&&4>=a?1:2},languages:["cs","sk"]},{plural:function(a){return 1==a?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2},languages:["csb"]},{plural:function(a){return 1==a?0:2==a?1:8!=a&&11!=a?2:3},languages:["cy"]},{plural:function(a){return 1==a?0:2==a?1:7>a?2:11>a?3:4},languages:["ga"]},{plural:function(a){return 1==a||11==a?0:2==a||12==a?1:a>2&&20>a?2:3},languages:["gd"]},{plural:function(a){return a%10!=1||a%100==11?1:0},languages:["is"]},{plural:function(a){return 0!=a?1:0},languages:["jv"]},{plural:function(a){return 1==a?0:2==a?1:3==a?2:3},languages:["kw"]},{plural:function(a){return a%10==1&&a%100!=11?0:a%10>=2&&(10>a%100||a%100>=20)?1:2},languages:["lt"]},{plural:function(a){return a%10==1&&a%100!=11?0:0!=a?1:2},languages:["lv"]},{plural:function(a){return 1==a||a%10==1?0:1},languages:["mk"]},{plural:function(a){return 0==a?0:1==a?1:2},languages:["mnk"]},{plural:function(a){return 1==a?0:0==a||a%100>1&&11>a%100?1:a%100>10&&20>a%100?2:3},languages:["mt"]},{plural:function(a){return 1==a?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2},languages:["pl"]},{plural:function(a){return 1==a?0:0==a||a%100>0&&20>a%100?1:2},languages:["ro"]},{plural:function(a){return a%100==1?1:a%100==2?2:a%100==3||a%100==4?3:0},languages:["sl"]}],a={en:function(a,b){return{word:a,suffixes:function(){switch(b.length){case 1:return["",b[0]];default:return b}}()}},ru:function(a,b){var c,d;switch(b.length){case 1:return{word:a,suffixes:["",b[0],""]};case 2:return c=b[1],d=a.slice(-c.length),{word:a.slice(0,-d.length),suffixes:[d].concat(b)};default:return{word:a,suffixes:b}}}},b.exports=function(){var b,d,e,f,g,h,i,j;for(e={},f=0,h=c.length;h>f;f++)for(b=c[f],j=b.languages,g=0,i=j.length;i>g;g++)d=j[g],e[d]={pluralize:b.plural,normalize:a[d]};return{_get:function(a,b){return null==b&&(b={useEnglishAsDefault:!0}),!e[a]&&b.useEnglishAsDefault&&(a="en"),e[a]},getPluralizeForm:function(a,b,c){return this._get(a,c).pluralize(b)},normalizeForms:function(a,b,c,d){var e;return(null!=(e=this._get(a,d).normalize)?e:this._doNotNormalize)(b,c)},updatePluralization:function(a,b,c){return e[a]={pluralize:b,normalize:c}},_doNotNormalize:function(a,b){return{word:a,suffixes:b}},preparePluralizationFn:function(a,b,c,d){var e,f=this;return e=this.normalizeForms(a,b,c,d),function(b){return e.word+e.suffixes[f.getPluralizeForm(a,b,d)]}},getLanguages:function(){return Object.keys(e)},getAll:function(){return e}}}}).call(this)},{}],8:[function(a,b){(function(){b.exports={onlyMarked:!0,textAsKey:"nokey",wordsLimitForKey:10,replaceSpaces:!1,generateSettingsFile:"settings.js"}}).call(this)},{}]},{},[4,1]),function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){(function(){b.exports=function(a){return a.service("auth",["backend","$rootScope","$timeout",function(a,b,c){var d,e,f,g;return f=function(){return b.$broadcast("auth:loggedIn")},g=function(){return b.$broadcast("auth:loginFailed")},e=function(a,b){return b?g():f()},d={loggedIn:!1,currentUser:a.currentUser,username:null,password:null,register:function(b,c,d,f){var g=this;return a.register(angular.extend({username:b,password:c},d),function(a,b){return b||(g.loggedIn=!0),e(a,b),f(a,b)})},login:function(b,c,d){var f=this;return a.login({username:b,password:c},function(a,b){return b||(f.loggedIn=!0),e(a,b),d(a,b)})},logout:function(b){var c=this;return a.logout(function(){return c.loggedIn=!1,g(),b()})},check:function(){var d=this;return b.$broadcast("auth:checking"),this.checking=!0,a.getLoginStatus(function(a){return c(function(){return d.checking=!1,d.loggedIn=a,e(a,!a)})})}}}])}}).call(this)},{}],2:[function(a,b){(function(){var a,c;c=function(){return Parse.User.current()},a=function(){return{currentUser:{},init:function(){return Parse.initialize("eXTzA1h8G4j7HzEpKbsHpJh4ZbzpkFKRzxn50gJp","vJpkQiAsEzDuoNGjRPUr0xcbgP2g7G4nnnQax7Mf")},getLoginStatus:function(a){var b,d;return b=null!=(d=c())?d.authenticated():void 0,b?(this._setCurrentUser(),a(b)):(Parse.User.logOut(),a(b))},_updateCurrentUser:function(a){var b=this;return null==a&&(a=function(){}),null===c()?a():c().fetch({success:function(){return b._setCurrentUser(),a()}})},_setCurrentUser:function(){var a;return angular.copy(null!=(a=c())?a.toJSON():void 0,this.currentUser)},register:function(a,b){var c,d=this;return c=new Parse.User(a),c.signUp(null,this.defaultHandler(function(a,c){return d._updateCurrentUser(function(){return b(a,c)})}))},login:function(a,b){var c=this;return Parse.User.logIn(a.username,a.password,this.defaultHandler(function(a,d){return c._setCurrentUser(),b(a,d)}))},logout:function(a){return Parse.User.logOut(),angular.copy({},this.currentUser),a()},loading:0,defaultHandler:function(a){var b=this;return null==a&&(a=function(){}),this.loading++,{success:function(c){return a(c),b.loading--},error:function(c,d){return $(b).trigger("backend.error",d),a(null,d),b.loading--}}}}},b.exports=a,window.Backend=a}).call(this)},{}],3:[function(a,b){(function(){var c;c=a("./parse"),b.exports=function(a){return a.service("backend",["$rootScope",function(a){var b;return b=c(),b.init(),$(b).on("backend.error",function(b,c){return console.error(c),a.$broadcast("backend.error",c)}),b}])}}).call(this)},{"./parse":2}],4:[function(a){(function(){var b,c,d,e;c=angular.module("puzzle",["granula"]),a("./backend/parse_angular")(c),e=function(a,b){return null==b&&(b=function(){}),a.$root.$$phase?b():a.$apply(b)},d=a("./ui")(c,e).getDialog,a("./tasks/selection")(c),a("./tasks/actions")(c),a("./auth/auth")(c),a("./model/tasks_angular")(c),c.config(["budgetProvider","statusProvider",function(a,b){return a.setErrorHandler(function(a){return b.onError(a),console.error("ERR",a)})}]),c.controller("global",["$scope","budget","auth","$location","status",function(a,b,c,d){var f;return a.loading=!0,f=function(){return a.budget={amount:0},a.booking={amount:function(){return void 0}}},f(),a.auth=c,a.$on("auth:loggedIn",function(){return b.load().then(function(b){return a.budget=b,a.booking=b.booked,a.loading=!1,e(a)},function(a){return a?console.error(a):void 0})}),a.$on("auth:loginFailed",function(){return d.path("/auth")}),a.logout=function(){return f(),b.unload(),c.logout(function(){})},c.check(),a.$on("$routeChangeSuccess",function(b,e){return"/auth"===d.path()||c.loggedIn||c.checking||d.path("/auth"),a.section=e.section}),a["import"]=function(){var b,c,d,e,f,g,h,i,j;for(b=a.budget,b.set(data.amount),d={},g=data.projects.length,j=data.projects,h=0,i=j.length;i>h;h++)e=j[h],f=b.addProject(e,function(){return g--,0===g?c():void 0}),d[f.name]=f;return c=function(){var a,b,c,e,g,h;for(g=data.tasks,h=[],c=0,e=g.length;e>c;c++)a=g[c],f=d[a.project],void 0!==f?h.push(b=f.addTask(a)):console.error("Cannot import task - unknown project '"+a.project+"' - "+JSON.stringify(a,null,4));return h}}}]),c.controller("footer",["$scope","status",function(a,b){return a.ajaxStatus=b.status,a.dialogs={error:{show:!1},help:{show:!1}},a.hideErrors=function(){return b.hideErrors()},a.clickInfo=function(){return b.status.showError?a.dialogs.error.show=!0:a.dialogs.help.show=!0}}]),c.controller("header",["$scope",function(a){return a.$watch("budget.amount",function(b){var c;if(null!=(c=a.auth)?c.loggedIn:void 0)return a.budget.set(b)}),a.budgetInEdit=null,a.editBudget=function(){return a.budgetInEdit?a.cancelBudget():a.budgetInEdit={amount:a.budget.amount,currency:a.budget.currency}},a.saveBudget=function(){return a.budget.currency=a.budgetInEdit.currency,a.budget.set(a.budgetInEdit.amount),a.budgetInEdit=null},a.cancelBudget=function(){return a.budgetInEdit=null}}]),c.config(["$routeProvider",function(a){return a.when("/",{controller:"projects",templateUrl:"./projects.html",section:"projects"}),a.when("/reports/:year/:month",{controller:"reports",templateUrl:"./reports.html",section:"reports"}),a.when("/reports/:year",{controller:"reports",templateUrl:"./reports.html",section:"reports"}),a.when("/reports",{controller:"reports",templateUrl:"./reports.html",section:"reports"}),a.when("/auth",{controller:"login",templateUrl:"./login.html"}),a.when("/:project",{controller:"project",templateUrl:"./project.html",section:"projects"})}]),c.controller("login",["$scope","auth","$location",function(a,b,c){var d,f;return a.auth=b,b.loggedIn?c.path("/"):(d=function(b,d){return a.logReg=!1,b?c.path("/"):(a.error=d,d.isLogin=!0),e(a)},f=function(){return a.error=null,a.logReg=!0},a.register=function(){return f(),b.register(a.auth.username,a.auth.password,{},d)},a.login=function(){return f(),b.login(a.auth.username,a.auth.password,d)})}]),c.controller("projects",["$scope","$location","tasksSelection",function(a,b,c){return a.newProject={title:""},a.addProject=function(){return a.newProject.title&&a.budget.addProject({name:a.newProject.title},function(c,d){return a.$apply(function(){return b.path("/"+d.objectId)})}),a.$apply()},a.deleteProject=function(a){return a["delete"]()},a.isBooked=function(b){return a.booking.include(b)},a.selection=c.createSelection(),a.$on("$destroy",function(){return a.selection.deselectAll()})}]),b="NIH_proj_show_completed",c.controller("project",["tasksSelection","budget","$scope","$routeParams","$location",function(a,c,d,f,g){var h,i,j;return d.showCompleted="true"===("undefined"!=typeof localStorage&&null!==localStorage?localStorage[b]:void 0),d.$watch("showCompleted",function(){return"undefined"!=typeof localStorage&&null!==localStorage?localStorage[b]=d.showCompleted:void 0}),h=f.project,c.whenLoad().then(function(a){var b;return d.project=a.getProject(h),null===d.project?(g.path("/"),void 0):(b=d.showCompleted?d.project.tasks:d.project.nonCompleted(),0===b.length&&(d.addTaskDialog=!0),e(d))}),j=function(a){return a=parseInt(a),(isNaN(a)||1>a)&&(a=1),a},d.currentTask={},i=function(){return d.newTask={title:"",cost1:0,amount:1}},i(),d.addTask=function(){return d.newTask.amount=j(d.newTask.amount),d.newTask.cost=d.newTask.cost1*d.newTask.amount,d.newTask.title&&d.project.addTask(d.newTask,function(){return e(d)}),i(),setTimeout(function(){return d.addTaskDialog=!0,d.$apply()},0)},d.deleteTask=function(a){return d.project.deleteTask(a)},d.toggleTask=function(a){return a.toggle().then(function(){return e(d)})},d.isBooked=function(a){return d.booking.include(a)},d.toggleBookingTask=function(a){return d.booking.toggle(a)},d.taskInEdit=null,d.editTask=function(a){var b;return b=d.isInEdit(a),d.cancelEdit(),b?void 0:(d.selection.deselectAll(),d.addTaskDialog=!1,d.taskInEdit={original:a,edited:$.extend({},a)},d.taskInEdit.edited.cost1=d.taskInEdit.edited.cost/d.taskInEdit.edited.amount)},d.cancelEdit=function(){return d.taskInEdit=null},d.saveTask=function(a){return a.withStatusUpdate(function(a){return a.title=d.taskInEdit.edited.title,a.amount=j(d.taskInEdit.edited.amount),a.cost=d.taskInEdit.edited.cost1*a.amount}),a.save(),d.cancelEdit()},d.isInEdit=function(a){var b;return(null!=(b=d.taskInEdit)?b.original:void 0)===a},d.selection=a.createSelection(),d.$on("$destroy",function(){return d.selection.deselectAll()})}]),c.controller("reports",["budget","$scope","$routeParams","$location",function(a,b,c,d){var f,g,h,i,j,k;return i=parseFloat(c.year),g=parseFloat(c.month),!isNaN(i)&&isNaN(g)&&(g=0),h=new Date,isNaN(i)&&isNaN(g)?(f=h,i=f.getFullYear(),g=f.getMonth()):i>h.getFullYear()||g>h.getMonth()?d.path("/reports"):(f=new Date,f.setFullYear(i),f.setMonth(g)),b.loading=!0,b.month=g,b.monthR=g,b.year=i,b.prev={month:0===g?11:g-1,year:0===g?i-1:i},b.next={month:11===g?0:g+1,year:11===g?i+1:i},b.hasNext=!0,b.loadReport=function(){return b.report={loading:!0},a.whenLoad().then(function(a){return b.report=a.report(b.month,b.year,2,2),b.hasNext=i<h.getFullYear()||g<h.getMonth(),e(b)})},b.loadReport(),b.taskInEdit={},b.isInEdit=function(a){return b.taskInEdit.task===a},b.months=[0,1,2,3,4,5,6,7,8,9,10,11],b.years=function(){k=[];for(var a=j=i-2,b=i+1;b>=j?b>=a:a>=b;b>=j?a++:a--)k.push(a);return k}.apply(this),b.editTask=function(a){return b.isInEdit(a)?b.cancelEdit():(b.taskInEdit.task=a,b.taskInEdit.edited={cMonth:a.cMonth,cYear:a.cYear})},b.cancelEdit=function(){return b.taskInEdit={}},b.saveTask=function(a){return a.cMonth=parseInt(b.taskInEdit.edited.cMonth),a.cYear=parseInt(b.taskInEdit.edited.cYear),isNaN(a.cMonth)||isNaN(a.cYear)?b.cancelEdit():(a.save({},{now:!0}).then(function(){return b.loadReport()}),b.cancelEdit())}}]),c.filter("nonCompleted",function(){return function(a,b){return b&&void 0!==a&&null!==a?a.filter(function(a){return!a.is("completed")}):a}}),c.service("projectThumbModel",function(){return{create:function(a,b){var c,d,e;return e=function(a){return a.tasks.length},c=function(a){var b,c,d,f,g,h;f=e(a),g={completed:"tasks completed",available:"tasks ready to be completed",unavailable:"tasks cannot be completed right now"},h=[];for(c in g)d=g[c],b=a[c]().length,h.push({percent:b/f*100,amount:b,total:f,name:c,title:"of "+f+" "+d});return h},d=function(a){var c,d,e,f,g,h;return c=a.available(),h=a.unavailable(),d=a.completed(),g=c.length+h.length+d.length,f=c.slice().concat(h).slice(0,b),f.length<c.length+h.length&&(f.pop(),e=g-b+1,f.push({rest:e,status:"more",text:"..."})),f},{update:function(){var b,d,e,f,g,h;for(g=c(a),h=[],b=e=0,f=g.length;f>e;b=++e)d=g[b],h.push(this.progressToShow[b]=d);return h},tasksToShow:d(a),progressToShow:c(a)}}}}),c.directive("projectThumb",["projectThumbModel","$location",function(a,b){return{scope:{project:"=projectThumb",selection:"=selection",deleteProject:"&deleteProject",isBooked:"&isBooked"},replace:!0,templateUrl:"partial/project-thumb.html",link:function(c,d,e){var f;return c.thumb=a.create(c.project,null!=(f=e.thumbs)?f:9,c.thumb),c.click=function(a){return"more"===a.status?b.path("/"+c.project.objectId):void 0},c.isSelected=function(a){return c.selection.isSelected(a)}}}}]),c.directive("ngEnter",function(){return function(a,b,c){return b.keydown(function(b){return 13===b.which?a.$apply(function(){return a.$eval(c.ngEnter)}):void 0})}})}).call(this)},{"./auth/auth":1,"./backend/parse_angular":3,"./model/tasks_angular":8,"./tasks/actions":9,"./tasks/selection":10,"./ui":11}],5:[function(a,b){(function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=[].slice;k={setSafe:function(a,b,c,d,e){var f,g,h;return f=a.get(b),"number"==typeof c?(g=c-(null!=f?f:0),a.increment(b,g)):a.set(b,c),h=new Parse.Promise,h._thenRunCallbacks({success:d,error:e}),a.save(null,{success:function(d){return d.get(b)===c?h.resolve(d):(void 0!==g&&(a.increment(b,-g),a.save()),h.reject({code:"conflict",message:"Conflict occurred"}))},error:function(a,b){return h.reject(b)}}),h},structToQuery:function(a,b){var c,d,e;d=new Parse.Query(a);for(c in b)e=b[c],"@currentUser"===e?d.equalTo(c,Parse.User.current()):d.equalTo(c,e);return d},afterFind:function(a,b,c){var d,e,f,g,h;return b.processItem=null!=(g=b.processItem)?g:function(a){return a},b.postProcessItem=null!=(h=b.postProcessItem)?h:function(a,b){return b(a)},e=a.length,f=[],0===e?c.resolve(f):(d=function(){return e--,0===e?c.resolve(f):void 0},f=a.map(b.processItem),f.forEach(function(a){return b.postProcessItem(a,d)}))},find:function(a,b,c){var d,e,f=this;return e=this.structToQuery(a,b),d=new Parse.Promise,d._thenRunCallbacks(c),e.find().then(function(a){return f.afterFind(a,c,d)},function(a){return d.reject(a)}),d}},c=function(){function a(a){var b,c;null==a&&(a={}),this.delay=null!=(b=a.delay)?b:1e3,this.idGetter=null!=(c=a.idGetter)?c:function(a){return a.id},this.saver=a.saver,this.queue=[],this.to=null}return a.prototype.save=function(a){var b,c,d=this;return(b=this.queue.filter(function(b){return d.idGetter(b.obj)===d.idGetter(a)})[0])?b.promise:(c=new Parse.Promise,this.queue.push({obj:a,promise:c}),clearInterval(this.to),this.to=setTimeout(this._save.bind(this),this.delay),c)},a.prototype._save=function(){var a,b,c,d,e,f=this;for(d=this.queue.splice(0,this.queue.length),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(function(a){var b,c;return b=a.obj,c=a.promise,f._saveObject(b).then(function(a){return c.resolve(a)},function(a){return c.reject(a)})}(a));return e},a.prototype._saveObject=function(a,b){return this.saver.save(a,b)},a.prototype.flush=function(){return this._save()},a.prototype.saveNow=function(a,b){return clearTimeout(this.to),this._save(),this._saveObject(a,b)},a}(),n=function(){return{save:function(a,b){return a.save(null,b)},saveNow:function(a,b){return a.save(null,b)},flush:function(){}}},m=function(a){var b;return null==a&&(a={}),a.saver=n(),b=new c(a),{save:function(a,c){return b.save(a,c)},saveNow:function(a,c){return b.saveNow(a,c)},flush:function(){return b.flush()}}},g=function(){function a(){}return a.properties=function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],a.length>0?this.prototype.getPropertyNames=function(){return a}:void 0},a.prototype.save=function(a,b){var c,e,f=this;return void 0===b&&((null!=a?a.success:void 0)?(b=a,a={}):b={}),b.data=a,this.objectId||(b.now=!0),this.beforeSave(),e=new Parse.Promise,e._thenRunCallbacks(b),c=!b.error,delete b.success,delete b.error,this.persistence().save(this,b).then(function(a){return f.load(a),e.resolve(f)
},function(a){return e.reject(a),c?d.onError(a):void 0}),e},a.prototype.load=function(a){var b,c,d;null==a&&(a={}),d=[];for(b in a)c=a[b],"@currentUser"!==this[b]&&("object"!=typeof this[b]||"string"!=typeof c||this[b].objectId!==c)&&(void 0!==this[b]&&void 0===c&&(console.error("Local value is defined, but value from server is undefined: obj == "+this.constructor.name+"["+this.objectId+"], prop == "+b+", oldVal = "+this[b]),c=this[b]),d.push(this[b]=c));return d},a.prototype.afterLoad=function(a){return a()},a.prototype.beforeSave=function(){},a.prototype.getPropertyNames=function(){return Object.keys(this).filter(function(a){return"function"!=typeof this[a]&&"_"!==a.charAt(0)&&"$"!==a.charAt(0)&&"persistence"!==a})},a.prototype.onError=function(a){return d.onError(a)},a}(),h=function(a){return null==a&&(a={linkToCurrentUser:!0}),function(b,c,e){var f,g,h;return g=null!=(h=c.PARSE_CLASS)?h:b,f=Parse.Object.extend(g),{find:function(a,b){return null==a&&(a={}),null==b&&(b={}),k.find(g,a,{success:b.success,error:b.error,processItem:function(a){var b;return b=new c,e(b,a),b.load(a.toJSON()),b},postProcessItem:function(a,b){return a.afterLoad(b)}})},init:function(b){var c;return c=new f,a.linkToCurrentUser&&c.setACL(new Parse.ACL(Parse.User.current())),e(b,c)},registerGlobalErrorHandler:function(a){return d.register(a)}}}},d={handler:function(a){return console.error(a)},register:function(a){this.handler=a},onError:function(a){return this.handler(a)}},o=function(a,b,c){var d,e,f,h,i,j,k,l;if(c)for(d in c)f=c[d],b[d]=f;for(j=b.getPropertyNames().concat(["objectId"]),l=[],h=0,i=j.length;i>h;h++)if(e=j[h],"number"==typeof b[e])l.push(a.increment(e,b[e]-(null!=(k=a.get(e))?k:0)));else if("@currentUser"===b[e])l.push(a.set(e,Parse.User.current()));else if(b[e]instanceof g){if(!b[e].objectId)throw new Error("Refered object "+e+" shall be saved first");l.push(a.set(e,b[e].objectId))}else l.push(a.set(e,b[e]));return l},i=function(a){return null==a&&(a=n()),function(b){return{save:function(c,d){var e,f,g,h;return h=d.now?"saveNow":"save",d.safe?(e=Object.keys(d.data)[0],c[e]=d.data[e],a.flush(),f=k.setSafe(b,e,d.data[e],d.success,d.error)):(o(b,c,d.data),f=a[h](b,d)),g=new Parse.Promise,f.then(function(a){return g.resolve(a.toJSON())},function(a){return g.reject(a)}),g}}}},j=function(){return function(a){var b;return b=1,{save:function(c,d){var e;return c.objectId||(c.objectId=""+c.constructor.name+"-"+b++),o(a,c,d.data),e=new Parse.Promise,e._thenRunCallbacks(d),e.resolve(c),e}}}},e=function(){return function(a,b,c){var d,e;return e={},d=function(a){return null==e[a]&&(e[a]=[]),e[a]},{find:function(b,c){var e;return e=new Parse.Promise,e._thenRunCallbacks(c),e.resolve(d(a).filter(function(a){var c,d;for(c in b)if(d=b[c],a[c]!==d&&"@currentUser"!==d)return!1;return!0})),e},init:function(b){return c(b,a,d)},registerGlobalErrorHandler:function(){}}}},f=function(){return function(a,b){return{save:function(c,d){var e,f,g,h,i;i=null!=(h=d.data)?h:{};for(e in i)g=i[e],c[e]=g;return c.objectId||(c.objectId=a+(new Date).getTime(),b(a).push(c)),f=new Parse.Promise,f._thenRunCallbacks(d),f.resolve(c),f}}}},l=function(a,b,c){var d;return d=function(e,f){var g,h,i,j,k,l;{if("object"!=typeof e){g=function(){var b,d,e;return e=arguments[0],b=2<=arguments.length?p.call(arguments,1):[],d=c.apply(null,b),e[a]=function(){return d}},k=b(e,f,g),l=[];for(j in k)i=k[j],l.push(f[j]=i);return l}h=e;for(e in h)f=h[e],d(e,f)}}},g.parseMixin=l("persistence",h(),i()),g.parseBgMixin=l("persistence",h(),i(m({delay:2e3}))),g.parseReadonlyMixin=l("persistence",h(),j()),g.memMixin=l("persistence",e(),f()),this.require=!1,a?b.exports=g:window.ModelMixin=g}).call(this)},{}],6:[function(a,b){(function(){var c,d;d=function(a,b){return a.filter(function(a){var c;return a.name===(null!=(c=b.name)?c:b)})[0]},c=function(){function a(){this._projects=[],this._dates=[]}return a.prototype.prependTasks=function(a,b,c){return this.addTasks_(a,b,c,"unshift")},a.prototype.addTasks=function(a,b,c){return this.addTasks_(a,b,c,"push")},a.prototype.addTasks_=function(a,b,c,e){var f,g,h,i,j,k,l,m,n;for(f={month:a,year:b},f.projects=[],j=0,l=c.length;l>j;j++)i=c[j],h=d(f.projects,i.cProjectName),h||(h={name:i.cProjectName},f.projects.push(h)),null==h.tasks&&(h.tasks=[]),null==h.sum&&(h.sum=0),h.tasks.push(i),h.sum+=i.cost;for(this._dates[e](f),n=f.projects,k=0,m=n.length;m>k;k++)g=n[k],d(this._projects,g)||this._projects.push({name:g.name});return this},a.prototype.build=function(a,b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(g={dates:this._dates,projects:this._projects,tasks:[],currentDateIdx:0},c=this._dates.filter(function(c){return c.month===a&&c.year===b})[0],g.currentDateIdx=this._dates.indexOf(c),o=null!=(n=null!=c?c.projects:void 0)?n:[],h=0,k=o.length;k>h;h++)f=o[h],g.tasks=g.tasks.concat(f.tasks);for(p=g.projects,i=0,l=p.length;l>i;i++)for(f=p[i],f.sums=[],q=g.dates,j=0,m=q.length;m>j;j++)e=q[j],f.sums.push(null!=(r=d(e.projects,f))?r.sum:void 0);return g},a}(),this.require=!1,a?b.exports=c:window.Report=c,window.dateUtils={nextMonth:function(a,b){var c,d,e;for(null==b&&(b=1),d={month:a.month,year:a.year},c=e=1;b>=1?b>=e:e>=b;c=b>=1?++e:--e)d.month++,d.month>=12&&(d.month=0,d.year++);return d},prevMonth:function(a,b){var c,d,e;for(null==b&&(b=1),d={month:a.month,year:a.year},c=e=1;b>=1?b>=e:e>=b;c=b>=1?++e:--e)d.month--,d.month<0&&(d.month=11,d.year--);return d}}}).call(this)},{}],7:[function(a,b){(function(){var c,d,e,f,g,h,i,j,k={}.hasOwnProperty,l=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};this.require=!1,a?(f=a("./persistence"),h=a("./report")):(f=window.ModelMixin,h=window.Report),j=function(a){var b,c,d;c={};for(b in a)k.call(a,b)&&(d=a[b],c[b]=d);return c},e=function(){function a(a,b){this.name=a,this.budget=b}return a.prototype.include=function(a){return null!=a.groups&&a.groups.indexOf(this.name)>-1},a.prototype.tasks=function(){var a=this;return this.budget.tasks.filter(function(b){return 0===b.completed&&0===b.deleted&&a.include(b)})},a.prototype.amount=function(){return this.tasks(this.budget).map(function(a){return a.cost}).reduce(function(a,b){return a+b},0)},a.prototype.toggle=function(a){return this.include(a)?a.groups.splice(a.groups.indexOf(this.name),1):a.groups.push(this.name),a.save()},a}(),i=function(a){function b(a){null==a&&(a={}),b.init(this),this.load(a),this.deleted=0,this.completed=0,this.afterLoad()}return l(b,a),b.properties("title","completed","deleted","cMonth","cYear","cProjectName","project","cost","budget","groups","amount"),b.prototype._checkCost=function(){return this.cost=parseInt(this.cost),isNaN(this.cost)&&(this.cost=0),this.amount=parseInt(this.amount),isNaN(this.amount)||this.amount<1?this.amount=1:void 0},b.prototype.afterLoad=function(a){return null==a&&(a=function(){}),this._checkCost(),null==this.amount&&(this.amount=1),null==this.groups&&(this.groups=[]),this.updateStatus(),a()},b.prototype.withBudget=function(a){return"object"==typeof this.budget?a(this.budget):void 0},b.prototype.withStatusUpdate=function(a){return a(this),this.updateStatus()},b.prototype.updateStatus=function(){var a=this;return this._checkCost(),1===this.completed?this.status="completed":this.withBudget(function(b){return a.status=b.getStatusForCost(a.cost)})},b.prototype.toggle=function(){return 1===this.completed?this.uncomplete():this.complete()},b.prototype.is=function(a){return a===this.status},b.prototype.complete=function(){var a,b=this;if(1!==this.completed)return this.withBudget(function(a){return a.onComplete(b)}),a=this.save({completed:1},{safe:!0,success:function(){var a;return a=new Date,b.save({cMonth:a.getMonth(),cYear:a.getFullYear(),cProjectName:b.project.name})},error:function(a){return"conflict"===a.code&&b.withBudget(function(a){return a.onUncomplete(b)}),b.onError(a)}}),this.updateStatus(),a},b.prototype.uncomplete=function(){var a,b=this;if(0!==this.completed)return this.withBudget(function(a){return a.onUncomplete(b)}),a=this.save({completed:0},{safe:!0,success:function(){},error:function(a){return"conflict"===a.code&&b.withBudget(function(a){return a.onComplete(b)}),b.onError(a)}}),this.updateStatus(),a},b.prototype["delete"]=function(){return this.save({deleted:1},{safe:!0})},b}(f),c="booked",d=function(a){function b(a){this.amount=(null!=a?a:{}).amount,b.init(this),this.tasks=[],this.booked=new e(c,this),this.owner="@currentUser"}return l(b,a),b.properties("amount","owner","currency"),b.prototype.linkRelation=function(a){var b=this;return function(c){return c[a]=function(a){return a(b)}}},b.prototype.afterLoad=function(a){var b=this;return null==this.currency&&(this.currency="RUR"),i.find({budget:this.objectId,deleted:0},{success:function(a){return a.forEach(function(a){return a.budget=b,a.updateStatus()}),b.tasks=a},error:function(a,c){return b.onError(c)}}).then(function(){return g.find({budget:b.objectId,deleted:0},{success:function(c){return c.forEach(function(a){return a.budget=b}),b.projects=c,b._linkProjectsTasks(),a()},error:function(a,c){return b.onError(c)}})})},b.prototype._linkProjectsTasks=function(){var a;return a={},this.projects.forEach(function(b){return a[b.objectId]=b}),this.tasks=this.tasks.filter(function(b){var c;return b.project?a[b.project]?(c=a[b.project],b.project=c,c.attachTask(b),!0):(console.error("Project with id = "+b.project+" does not belong to this budget"),!1):(console.error("Task does not have link to project, so it will be ignored"),!1)})},b.prototype.isEnough=function(a){return a.cost<=this.amount},b.prototype.getStatusForCost=function(a){return this.isEnough({cost:a})?"available":"unavailable"},b.prototype.report=function(a,b,c,d){var e,f,g,j,k=this;return null==c&&(c=0),null==d&&(d=0),g={loading:!0},f=function(a,b,c,d,e){return i.find({budget:k.objectId,completed:1,cMonth:a,cYear:b}).then(function(g){return c.prependTasks(a,b,g),d>0?(a--,0>a&&(a=11,b--),f(a,b,c,d-1,e)):e(c)},function(a){return k.onError(a)})},e=new h,j=dateUtils.nextMonth({month:a,year:b},d),f(j.month,j.year,e,c+d,function(){var c;return c=e.build(a,b),g.tasks=c.tasks,g.currentDateIdx=c.currentDateIdx,g.dates=c.dates,g.projects=c.projects,g.loading=!1}),g},b.prototype.set=function(a,b){var c;return null==b&&(b=!1),c=parseInt(a),void 0===this.amount&&(this.amount=a),this.amount!==c?(this.save({amount:c},{now:b}),this.updateStatuses()):void 0},b.prototype.onComplete=function(a){return this.set(this.amount-a.cost)},b.prototype.onUncomplete=function(a){return this.set(this.amount+a.cost)},b.prototype.updateStatuses=function(a){return null==a&&(a=this),a.tasks.forEach(function(a){return a.updateStatus()})},b.prototype.addProject=function(a,b){var c,d=this;return null==b&&(b=function(){}),a=j(a),a.budget=this,c=new g(a),c.save().then(function(a){return a.budget=d,d.projects.push(a),b(null,a)},function(a){return b(a)}),c},b.prototype.getProject=function(a){var b;return null!=(b=this.projects.filter(function(b){return b.objectId===a})[0])?b:null},b.prototype.deleteProject=function(a){return this.projects.splice(this.projects.indexOf(a),1),a.tasks.forEach(function(a){return a["delete"]()})},b.prototype.addTask=function(a,b){var c,d=this;return null==b&&(b=function(){}),a=j(a),a.budget=this,c=new i(a),this.tasks.push(c),c.project.tasks.push(c),c.save().then(function(c){return d.linkRelation("withBudget")(c),d.updateStatuses(a.updateStatusesFor),b(null,c)},function(a){return b(a)}),c},b.load=function(a){return b.find({owner:"@currentUser"},{success:function(c){return c.length>0?a(null,c[0]):new b({amount:0}).save().then(function(b){return a(null,b)},function(b){return a(b)})},error:function(b,c){return a(c)}})},b}(f),g=function(a){function b(a){var c;c=null!=a?a:{},this.name=c.name,this.budget=c.budget,b.init(this),this.deleted=0,this.tasks=[]}return l(b,a),b.PARSE_CLASS="Project2",b.properties("name","deleted","budget"),b.prototype.attachTask=function(a){return this.tasks.push(a)},b.prototype.nonDeleted=function(){return this.tasks.filter(function(a){return!a.deleted})},b.prototype.completed=function(){return this.tasks.filter(function(a){return"completed"===a.status})},b.prototype.nonCompleted=function(){return this.tasks.filter(function(a){return"completed"!==a.status})},b.prototype.available=function(){return this.tasks.filter(function(a){return"available"===a.status})},b.prototype.unavailable=function(){return this.tasks.filter(function(a){return"unavailable"===a.status})},b.prototype.addTask=function(a,b){return a=j(a),a.project=this,this.budget.addTask(a,b)},b.prototype.deleteTask=function(a){var b;return b=a["delete"](),this.tasks.splice(this.tasks.indexOf(a),1),b},b.prototype["delete"]=function(){var a;return a=this.save({deleted:1},{safe:!0}),this.budget.deleteProject(this),a},b}(f),f.parseMixin({Task:i,Budget:d,Project:g}),a?b.exports={Budget:d,remix:function(a){return a({Task:i,Budget:d,Project:g})}}:(window.Budget=d,window.Task=i,window.Project=g)}).call(this)},{"./persistence":5,"./report":6}],8:[function(a,b){(function(){var c,d,e,f,g=[].slice;f=a("./tasks"),c=f.Budget,e=f.remix,d=a("./persistence"),b.exports=function(a){return a.run(["$rootScope","$timeout",function(a,b){var c,d,e;return e=Parse._ajax,d=0,c=function(){return d--,0>=d?(d=0,b(function(){return a.$apply()})):void 0},Parse._ajax=function(){var a,b;return a=1<=arguments.length?g.call(arguments,0):[],d++,b=e.call.apply(e,[Parse].concat(g.call(a))),b.then(c,c),b}}]),a.provider("budget",function(){var a;return a="production",e(d.parseBgMixin),{setErrorHandler:function(a){return c.registerGlobalErrorHandler(a)},setMode:function(b){return a=b,"debug"===a?(console.log("switch to readonly"),e(d.parseReadonlyMixin)):"local"===a?(console.log("switch to memory"),e(d.memMixin)):void 0},$get:function(){var b;return c.mode=a,b=new Parse.Promise,{unload:function(){return b=new Parse.Promise},load:function(){return c.load(function(a,c){return a?b.reject(a):b.resolve(c)}),b},whenLoad:function(){return b},getStatusForCost:function(a){return c.getStatusForCost(a)}}}}})}}).call(this)},{"./persistence":5,"./tasks":7}],9:[function(a,b){(function(){b.exports=function(a){return a.directive("taskSelectionList",function(){return{restrict:"E",replace:!0,scope:{selection:"=selection"},templateUrl:"actions.html",link:function(a,b,c){return a.options=a.$parent.options,a.toggleBooked=function(){return a.selection.toggleBookingTask()},a.toggleTask=function(){return a.selection.toggle(),void 0!==c.autoClose?a.selection.deselectAll():void 0},a.$watch(a.selection.$watch(),function(){return a.taskBooked=a.selection.isBooked(),a.task=a.selection.getSelectionAsTask()},!0)}}}),a.directive("taskActionsList",function(){return{restrict:"E",replace:!0,scope:{task:"=",booking:"="},templateUrl:"actions.html",link:function(a){return a.options=a.$parent.options,a.toggleBooked=function(){return a.booking.toggle(a.task)},a.toggleTask=function(){return a.task.toggle()},a.$watch(function(){var b;return"function"==typeof(b=a.booking).include?b.include(a.task):void 0},function(b){return a.taskBooked=b})}}})}}).call(this)},{}],10:[function(a,b){(function(){b.exports=function(a){return a.service("tasksSelection",function(){var a;return a=function(){function a(){this.tasks=[]}return a.prototype.toggleSelection=function(a){var b;return b=this.tasks.indexOf(a),-1===b?this.tasks.push(a):this.tasks.splice(b,1)},a.prototype.isSelected=function(a){return this.tasks.indexOf(a)>-1},a.prototype.hasOtherSelectedThan=function(a){return this.tasks.length>1||this.tasks[0]!==a},a.prototype.deselectAll=function(){return this.tasks.splice(0,this.tasks.length)},a.prototype["delete"]=function(){return this.tasks.forEach(function(a){return a.project.deleteTask(a)}),this.deselectAll()},a.prototype.$watch=function(){var a=this;return function(){return a.getSelectionAsTask()}},a.prototype.toggleBookingTask=function(){var a,b,c;return 0===this.tasks.length?!1:(a=this.tasks[0].budget.booked,b=this.isBooked(),c=this.tasks.filter(function(c){return a.include(c)===b}),c.forEach(function(b){return a.toggle(b)}))},a.prototype.toggle=function(){var a,b;return a=this.tasks.filter(function(a){return!a.is("completed")}),b=0===a.length?this.tasks:a,b.forEach(function(a){return a.toggle()})},a.prototype.isBooked=function(){var a;return 0===this.tasks.length?!1:(a=this.tasks[0].budget.booked,this.tasks.every(function(b){return a.include(b)}))},a.prototype.getSelectionAsTask=function(){var a,b,c;return b=this.tasks.filter(function(a){return!a.is("completed")}),c={booked:this.isBooked()},0===b.length?(c.cost=this.tasks.map(function(a){return a.cost}).reduce(function(a,b){return a+b},0),c.status="completed"):(a=b[0].budget,c.cost=b.map(function(a){return a.cost}).reduce(function(a,b){return a+b},0),c.status=a.getStatusForCost(c.cost)),c},a}(),{createSelection:function(){return new a}}}),a.directive("selectTo",function(){return function(a,b,c){var d,e;return d=a.$eval(c.selectTo),e="ctrl-click"===c.selectWith,b.click(function(b){var f;return f=a.$eval(c.select),e&&!b.ctrlKey&&d.hasOtherSelectedThan(f)&&d.deselectAll(),d.toggleSelection(f),a.$apply()})}})}}).call(this)},{}],11:[function(a,b){(function(){b.exports=function(a,b){var c,d,e,f,g,h,i;return h=function(a,b,c){var d;return d=function(){return a.$parent.$eval(""+b+" = "+c)},a.$root.$$phase?d():a.$apply(function(){return d()})},i=function(a,b){return h(a,b,"!"+b)},a.directive("dialogPanelTrigger",function(){return{scope:{dialogPanelTrigger:"@"},link:function(a,b,c){return a.$parent.$watch(c.dialogPanelTrigger,function(a){return void 0!==a?$(b).toggleClass("dialog-trigger-pressed",a):void 0}),$(b).click(function(){return i(a,c.dialogPanelTrigger)})}}}),g=function(a){return $("*[show-if="+a+"]").data("dialog")},a.directive("dialogPanel",function(){return{transclude:!0,restrict:"E",replace:!0,scope:{onSave:"&",onClose:"&",onHide:"&",saveButtonTitle:"@",cancelButtonTitle:"@",doNotClearForm:"@"},template:"<div class=\"dialog-panel\" ng-class=\"{shown: showIf}\">\n  <form class=\"clearfix\">\n    <div ng-transclude class='dialog-content'></div>\n    <div class='buttons'>\n      <button class='btn btn-primary' data-action=\"save\">{{ saveButtonTitle || 'Save' }}</button>\n      <button class='link' data-action=\"cancel\">{{ cancelButtonTitle || 'Close'}}</button>\n    </div>\n  </form>\n</div>",link:function(a,b,c){var d;return d={form:b.find("form"),origin:b.parent(),_show:function(){return a.showIf=!0,setTimeout(function(){var a;try{return b.find("input")[0].focus()}catch(c){a=c}},100)},showAt:function(c){var d=this;return b.parent[0]!==c[0]&&c.append(b),setTimeout(function(){return d._show(),a.$apply()},0)},show:function(){return this.showAt(this.origin)},hide:function(b,c){return a.showIf=!1,b&&a.onSave&&a.onSave(),c&&a.onClose&&a.onClose(),a.onHide?a.onHide():void 0},hideIfAt:function(a){return b.parent()[0]===a[0]?this.hide():void 0},save:function(){return this.hide(!0),this.clearForm()},cancel:function(){return this.hide(!1,!0),this.clearForm()},clearForm:function(){return void 0===c.doNotClearForm?this.form.find("input,textarea").val(""):void 0}},a.$parent.$watch(c.showIf,function(a){return a?d.show():d.hide()}),b.find("*[data-action=save]").click(function(){return d.save(),a.$apply()}),b.find("*[data-action=cancel]").click(function(){return d.cancel(),a.$apply()}),b.data("dialog",d)}}}),a.directive("currency",function(){return{template:"<span class='currency'>{{budget.currency}}</span>",restrict:"E"}}),d=100,a.directive("countdown",["$timeout",function(a){return function(b,c,e){var g,h,i,j,k;return j=null,i=null,k=0,g=!1,h=function(a){return c.is("input")?c.val(a):c.html(f(a,"&nbsp;")+"")},c.on("focus",function(){return g=!0}).on("blur",function(){return g=!1}),b.$watch(e.countdown,function(f){var l,m,n;if(clearTimeout(j),!g){for(i=parseInt(f),isNaN(i)&&(i=0),c.addClass("start-counting"),m=null!=(n=b.$eval(e.step))?n:1;Math.abs(i-k)/m>d;)m=2*m;return l=function(){return g&&(k=i),i===k?(c.removeClass("start-counting"),h(i),void 0):(i>k?(k+=m,k>i&&(k=i)):(k-=m,i>k&&(k=i)),h(k),j=a(l,10))},l()}})}}]),a.directive("uiTitle",function(){return function(a,b,c){var d,e;return b.tooltip({placement:null!=(d=null!=(e=c.placement)?e:c.position)?d:"right",html:!0,title:function(){return b.attr("ui-title")}})}}),a.directive("uiDialog",function(){return{transclude:!0,restrict:"E",replace:!0,template:'<div class="modal" role="dialog" id="help" aria-hidden=\'true\'>\n  <div class=\'modal-header\'></div>\n  <div class="modal-body" ng-transclude>\n  </div>\n  <div class="modal-footer">\n    <button class="btn btn-primary" data-dismiss=\'modal\'>{{closeTitle}}</button>\n  </div>\n</div>',scope:{model:"=",closeTitle:"@",closeAction:"&"},link:function(a,c){return $.support.transition=!1,$(c).modal(),$(c).modal("hide"),$(c).on("shown",function(){return b(a,function(){return a.model.show=!0})}),$(c).on("hidden",function(){return b(a,function(){return a.closeAction(),a.model.show=!1})}),a.$watch("model.show",function(){return $(c).modal(a.model.show?"show":"hide")},!0)}}}),e=function(a,b){var c;for(c=a+"";c.length<b;)c="0"+c;return c},f=function(a,b){var c,d,f;if(null==b&&(b=" "),d=[],c=parseFloat(a),isNaN(c)&&(c=0),0===c)return 0;for(;c>0;)f=c%1e3,c=c/1e3|0,d.unshift(c>0?e(f,3):f);return d.join(b)},a.filter("cost",function(){return f}),a.filter("month",["grService",function(a){return function(b){return a.compile("month"+b)}}]),c="NIH_language",a.directive("langSelector",["$rootScope","grService",function(a,b){var d;return a.currentLanguage=null!=(d=localStorage[c])?d:b.originalLanguage,a.$on("gr-lang-changed",function(b,d){return a.currentLanguage=d,localStorage[c]=d}),{replace:!0,restrict:"E",templateUrl:"partial/language-selector.html",link:function(a){return a.languages=["en","ru"],a.changeLanguage=function(a){return b.setLanguage(a)}}}}]),a.directive("longClick",function(){return{link:function(a,b,c){var d,e,f;return f=!1,b.addClass("long-click"),b.click(function(){return f=!0,b.addClass("processing"),a.$apply(c.longClick),a.$eval(c.processing)===!1?e():void 0}),d=function(){return f?void 0:b.attr("disabled","disabled")},e=function(){return b.removeClass("processing"),b.removeAttr("disabled"),f=!1},a.$watch(c.processing,function(a){return a?d():e()})}}}),a.provider("status",function(){return{status:{showHelp:!0,showError:!1,error:null},onError:function(a){return this.status.error=a,this.status.showError=!0,this.status.showHelp=!1},hideErrors:function(){return this.status.error=null,this.status.showHelp=!0,this.status.showError=!1},$get:function(){return this}}}),{getDialog:g}}}).call(this)},{}]},{},[1,3,2,4,5,6,7,8,9,10,11]);